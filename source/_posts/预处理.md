---
title: 预处理
date: 2018-04-12 13:20:33
tags: 
  - "预处理"
categories: "c语言学习"
---
## 特点
1、 都是以 #开头
2、 预处理都是在编译之前执行
3、 预处理指令都没有分号
## c语言从编写到编译、链接、执行流程
1、 新建一个.c的源文件，.c的文件是c程序的源文件
2、 在.c的源文件中，可以写上按照c语法规范的源代码
3、 c语言严格区分大小写，除了字符串常量，其他地方必须使用英文输入法
4、 使用cc -c 指令去编译源文件，编译做的事情
- 先执行源文件中的预处理指令，如果有文件包含指令，就将文件的内容拷贝到写指令的地方
- 检查.c文件中的语法是否符合规范
  * 如果符合，则生成.o目标文件，就是.c文件对应的二进制指令
  * 如果不符合语法规范，就报错，不会生成.o的目标文件

5、 链接 cc xx.o目标文件 
- 为.o的目标文件添加启动代码
- 链接函数，告诉编译器要调用的函数在什么地方，调用的时候，去正确的地方找实现
- 链接成功以后，就会生成一个可执行的文件a.out

## 预处理指令的分类
1、 文件包含指令 #include 
2、 宏定义： 可以将1段代码定义为1个标识，使用这个标识就可以使用这段代码
3、 条件编译指令： 只编译指定的c代码为二进制指令

## 宏定义

1、 是一个预处理指令，它在编译之前执行
2、 作用：可以为一段c代码定义一个标识，如果要使用这段c代码，那么使用这段标识就可以
3、 语法：#define 宏名 宏值
```
#define N 10
```
4、 使用： 在c代码中，直接使用宏的名称就可以了
```
int a=N +1;
```

5、 宏的原理
在预编译的时候，就会执行源文件中的预处理指令，会将c代码中使用宏名的地方替换为宏值。将c代码中的宏名替换为宏值的过程叫做宏替换/宏代换

6、 使用宏的时候，注意点

- 宏值可以定义任意的内容，在宏替换的时候，会把宏值原封不动的替换掉。在定义宏的时候，不会检查语法
- 无论宏值是什么，在定义宏的时候，不会去检查语法，只有当完成了宏替换的时候，才会去检查替换以后，是否符合语法规范
- 如果宏值是一个表达式，那么宏值并不是这个表达式的结果，而是这个表达式本身
- 如果宏值中包括一个变量名，那么在使用这个宏之前，要保证变量已经声明
- 宏值无法赋值，不能修改值，因为宏不是变量
- 宏的作用域，宏可以定义在函数的里面也可以定义在函数的外面。从定义宏的地方开始，后面所有的地方都可以直接使用。就算这个宏，定义在括弧里面，在大括弧的外面也可以访问
- 字符串中如果出现了宏名，系统不会认为他是一个宏，不会替换
- 宏值当中用到了另外一个宏名。那么就会先将宏值当中的宏名替换为对应的宏值
- 如果宏值后面跟了一个分号，系统会把分号当作宏值的一部分，替换的时候会连分号一起替换
- 可以把任意的c代码定义为宏

##  undef 
默认的情况下，宏从定义的地方一直到文件结束都可以使用，使用 #undef 宏名，可以让宏失效

## #define 和 typedef 的区别

1、 #define是一个预处理命令，在编译的时候执行，在预编译的时候会把宏名替换成宏值。typedef是一个c代码，在运行的时候才会执行
2、 #define 可以将任意的c代码取一个标识名，typedef只能为数据类型取名字

## 带参数的宏

1、 在定义宏的时候，宏名可以带参数，在这个宏值当中，可以直接使用这个参数 
2、 如果使用的宏有参数，就必须为此宏传值

```
#define N(a) a+a+1
int main(int argc, const char * argv[]) {
    int b=N(2);
    printf("b=%d\n",b);
    return 0;
}
```

3、 宏代换的原理
- 先将传入的值，传递给宏的参数，那么宏参数的值就是我们传递的值
- 再把宏值当中使用参数的地方换成参数的值
- 最后，再将使用宏名的地方，替换为最后的宏值

4、 注意点

- 宏不是函数，所以宏的参数不需要添加数据类型说明符，直接写参数即可
- 定义宏的时候，编译器区分宏名和宏值是根据 #define 空格 宏名 空格 宏值，第一个空格和第二个空格之间的内容会作为宏名，第二个空格之后的内容会作为宏值，写宏的时候，要注意空格
- 为带参数的宏传值的时候，是本色传递。如果传递一个变量，并不是传递这个变量的值，而是直接传递这个变量的名称串
- 宏一定程度上，可以实现和函数一样的效果，但是宏有缺点宏一旦换行就会认为宏定义结束了
- 只有当代码很少的时候，只有几句的时候，可以使用宏

## 条件编译指令
1、是一个与编译指令，在预编译阶段执行
2、作用：

- 默认情况下，所有的c代码都会被编译为二进制代码
- 条件编译指令的作用：可以让编译器只编译指定的部分代码

3、 用法：

- 第一种用法,在预编译的时候，如果条件成立，则会将其中的c代码编译成二进制指令，如果不成立，则不会将c代码编译成二进制指令。注意：条件只能是宏，不能是变量
```
#if 条件
   c代码;
#endif
```
- 第二种用法，
```
#if 条件
    c代码;
#elif 条件
    c代码;
#elif 条件
    c代码;
……
#else
    c代码；
#endif
```

- 第三种用法,如果定义了指定的宏，就编译其中的代码
```
#ifdef N
    printf("hello world1\n");
    printf("hello world1\n");
    printf("hello world1\n");
    printf("hello world1\n");
#endif

```

4、 使用场景，比如打印日志调试的时候，如下

- 场景1
```
#define FZ_DEBUG 0
#if FZ_DEBUG==1
#define LOG(val1,val2) printf(val1,val2);
#else
#define LOG(val1,val2)
#endif

int main(int argc, const char * argv[]) {
    
    int a=19;
    LOG("%d\n",a);
}
```

- 场景2 在引用文件头文件的时候，无论头文件被#include了多少次，都只希望被包含一次

```
#ifndef 宏名

#define 宏名
    代码;

#endif

```



