---
title: 申请内存
date: 2018-04-12 12:11:33
tags: 
  - "内存"
categories: "c语言学习"
---
## malloc函数

1、 如何向堆区中申请空间来使用

- 如果在堆中申请的字节空间，如果不去主动释放，那么系统也不会释放的，除非程序结束
- 在堆中申请字节空间的步骤
    * 申请
    * 使用
    * 释放
- 有如下3个函数和申请字节空间有关的
    * malloc()
    * calloc()
    * realloc()
    * 上面三个函数的声明，都是放在一个叫做stdlib.h的系统头文件中

## malloc 函数
1、 作用： 向堆空间申请指定字节的空间来使用
2、 参数只有1个：size_t类型的，也就是unsigned long，意义：向堆内存中申请多少个连续的字节空间
3、 在堆内存中申请连续的参数个字节空间
4、 返回值是： void * ，代表没有类型的指针。返回的是创建的空间中的第一个字节的地址
5、 应该使用什么类型的指针变量来保存malloc函数返回的地址，取决于想要如何去操作这些字节空间
    * 如果想要操作4个字节，并当作整型则使用int指针
    * 如果想要操作8个字节，使用double指针
    * 如果想要操作1个字节，使用char指针
    * 如果想要操作4个字节， 并当作float类型则使用float指针

```
    // 申请长度为6的int类型数组空间
    int* p1 = malloc(24);
    *p1 = 100;
    *(p1+1)=200;
    *(p1+2)=300;
    *(p1+3)=400;
    *(p1+4)=500;
    *(p1+5)=600;

    for(int i=0;i<6;i++){
        printf("%d\n",p1[i]);
    }
```
6、 在堆区申请的字节空间，是从低地址向高地址分配的。每次申请的字节地址都是从0开始，每一次申请的字节空间不一定是挨在一起。但是每一次申请指定个字节一定是连续的。

7、 在堆区申请的字节，里面是有值，但是值是垃圾值，不会自动清零

8、 在向堆区申请字节空间的时候，有可能申请失败。如果申请失败，返回的指针就是null值。申请完空间之后，最好是判断下，判断是否申请成功
```
int* p1 = malloc(4);
if(p1) 
{
    // 代表申请成功，todo
}
```

9、 申请的空间使用完毕之后，一定要记住释放
- free(指针)；如果没有free，程序要结束后才会被释放

```
    int* p1 = malloc(120);
    if(p1){
        for(int i=0;i<30;i++){
            *(p1+i)=i*10;
        }
        for(int i=0;i<30;i++){
            printf("%d\n",p1[i]);
        }
        free(p1);
    }
```

## calloc 函数

1、 作用：向堆区申请字节空间
2、 格式：
- calloc(多少个单位，每个单位的字节数)
如： calloc（4，sizeof(int);表示申请4个int类型的空间

```
    int* p1=calloc(30,sizeof(int));
    if(p1){
        for(int i=0;i<30;i++){
            printf("%d\n",p1[i]);
        }
    }
```
3、 申请完的字节，系统会将字节中的数据清零

## realloc 函数
1、 作用： 扩容
2、 注意： 有了指针，几乎就可以操作内存上面的每一个字节。建议只操作自己申请的内存空间，用了未申请的空间，有可能会出现问题。
3、 当发现之前在堆区申请的字节空间不够用的时候，可以使用realloc来扩容
4、 如果原来的空间后面还有剩余的空间，并且足够扩容，那么直接在后面扩容
5、 如果原来的空间后面还有剩余的空间，但是不够扩容，就重新找一块足够的空间来扩容。将原来的数据拷贝过来，原来的空间自动释放。


